{
  "info": {
    "name": "FastX Courier - OTP Verification Flow",
    "_postman_id": "otp-verification-flow",
    "description": "Complete OTP verification flow for FastX Courier Service",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. Signup (Get OTP)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Test User\",\n  \"email\": \"testuser@example.com\",\n  \"phone\": \"+8801712345678\",\n  \"password\": \"SecurePass123!\",\n  \"role\": \"customer\",\n  \"city\": \"Dhaka\",\n  \"area\": \"Gulshan\",\n  \"address\": \"House 10, Road 5, Gulshan-1\"\n}"
        },
        "url": {
          "raw": "http://localhost:3001/api/auth/signup",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3001",
          "path": ["api", "auth", "signup"]
        },
        "description": "Step 1: Register a new user. This will generate an OTP and store it in the database.\n\n**Expected Response:**\n```json\n{\n  \"message\": \"User created successfully. Please verify your account with OTP.\",\n  \"email\": \"testuser@example.com\",\n  \"phone\": \"+8801712345678\"\n}\n```\n\n**What happens:**\n- User is created with `isVerified: false`\n- 6-digit OTP is generated and saved to database\n- OTP expires in 5 minutes (300 seconds)\n- In development mode (SMS_PROVIDER=log), check server console logs for the OTP code\n\n**Note:** Check your server console logs to see the OTP code!"
      },
      "response": []
    },
    {
      "name": "2. Check Database for OTP (Optional)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "http://localhost:3001/api/users",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3001",
          "path": ["api", "users"]
        },
        "description": "Optional: If you have a users endpoint, you can check the database to see the OTP code.\n\n**Alternative:** Connect to PostgreSQL directly:\n```sql\nSELECT email, \"otpCode\", \"otpExpiry\", \"isVerified\" \nFROM users \nWHERE email = 'testuser@example.com';\n```"
      },
      "response": []
    },
    {
      "name": "3. Verify OTP",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"testuser@example.com\",\n  \"otpCode\": \"123456\"\n}"
        },
        "url": {
          "raw": "http://localhost:3001/api/auth/verify-otp",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3001",
          "path": ["api", "auth", "verify-otp"]
        },
        "description": "Step 2: Verify the OTP code received.\n\n**Replace `123456` with the actual OTP from:**\n- Server console logs (if SMS_PROVIDER=log)\n- SMS message (if SMS provider is configured)\n- Database query\n\n**Expected Success Response (200 OK):**\n```json\n{\n  \"message\": \"Account verified successfully\",\n  \"user\": {\n    \"id\": \"uuid\",\n    \"email\": \"testuser@example.com\",\n    \"name\": \"Test User\",\n    \"phone\": \"+8801712345678\",\n    \"role\": \"customer\",\n    \"isVerified\": true,\n    \"isActive\": true\n  },\n  \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n```\n\n**Expected Error Responses:**\n- **400 Bad Request** - Invalid OTP:\n  ```json\n  {\n    \"statusCode\": 400,\n    \"message\": \"Invalid OTP\"\n  }\n  ```\n- **400 Bad Request** - Expired OTP:\n  ```json\n  {\n    \"statusCode\": 400,\n    \"message\": \"OTP expired. Please request a new one.\"\n  }\n  ```\n- **400 Bad Request** - Already verified:\n  ```json\n  {\n    \"statusCode\": 400,\n    \"message\": \"Account already verified\"\n  }\n  ```"
      },
      "response": []
    },
    {
      "name": "4. Login After Verification",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"testuser@example.com\",\n  \"password\": \"SecurePass123!\"\n}"
        },
        "url": {
          "raw": "http://localhost:3001/api/auth/login",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3001",
          "path": ["api", "auth", "login"]
        },
        "description": "Step 3: Login with verified account.\n\n**Expected Success Response (200 OK):**\n```json\n{\n  \"user\": {\n    \"id\": \"uuid\",\n    \"email\": \"testuser@example.com\",\n    \"name\": \"Test User\",\n    \"isVerified\": true\n  },\n  \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n```\n\n**Note:** If account is not verified, this will send a new OTP:\n```json\n{\n  \"statusCode\": 400,\n  \"message\": \"Account not verified. A new OTP has been sent.\"\n}\n```"
      },
      "response": []
    },
    {
      "name": "5. Login Unverified Account (Get New OTP)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"unverified@example.com\",\n  \"password\": \"SecurePass123!\"\n}"
        },
        "url": {
          "raw": "http://localhost:3001/api/auth/login",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3001",
          "path": ["api", "auth", "login"]
        },
        "description": "Alternative Flow: Login with unverified account to get a new OTP.\n\n**Steps:**\n1. Try to login with unverified account\n2. System generates NEW OTP and sends it\n3. Check console logs for new OTP\n4. Use the new OTP in verify-otp endpoint\n\n**Expected Response (400 Bad Request):**\n```json\n{\n  \"statusCode\": 400,\n  \"message\": \"Account not verified. A new OTP has been sent.\"\n}\n```\n\n**What happens:**\n- New OTP is generated\n- OTP expiry is reset to 5 minutes\n- Check server console for the new OTP code"
      },
      "response": []
    }
  ]
}
